# ğŸ§ª 802.1X ì‹¤ìŠµ ê¸°ë¡ (FreeRADIUS + DHCP + VLAN 810 + Windows Client)

> **ëª©í‘œ**  
> ë‹¨ë§(Windows)ì´ 802.1X ì¸ì¦ ì„±ê³µ ì‹œ **VLAN 810** ìœ¼ë¡œ ë“¤ì–´ê°€ê³ ,  
> **DHCP** ë¡œ IPë¥¼ ë°›ì•„ í†µì‹  ê°€ëŠ¥í•˜ê²Œ êµ¬ì„±í•œë‹¤.  
> (Lab: **EVE-NG / Ubuntu / FreeRADIUS / Cisco Switch**)

---

## ğŸ—ºï¸ êµ¬ì„± ìš”ì•½

### ì„œë²„(Ubuntu)
- FreeRADIUS IP: `10.0.10.11`
- DHCP ì œê³µ VLAN: `810`
- DHCP ì„œë²„ ì¸í„°í˜ì´ìŠ¤: `ens4.810`

### ë„¤íŠ¸ì›Œí¬
| êµ¬ë¶„ | ì¸í„°í˜ì´ìŠ¤ | IP | ìš©ë„ |
|---|---|---|---|
| ê´€ë¦¬/Radius | `ens3` | `10.0.10.11/28` | RADIUS/ê´€ë¦¬ë§, ê¸°ë³¸ ë¼ìš°íŠ¸ |
| L2 ì—°ê²° | `ens4` | `192.168.0.11/24` | ìŠ¤ìœ„ì¹˜ ì—°ë™(ë¬¼ë¦¬) |
| VLAN 810 | `ens4.810` | `192.168.81.11/24` | DHCP ì œê³µ(ê°€ìƒ) |

> âœ… **ì¤‘ìš”:** ê¸°ë³¸ ë¼ìš°íŠ¸(default route)ëŠ” **í•˜ë‚˜ë§Œ**(ë³´í†µ ens3) ìœ ì§€í•œë‹¤.  
> ens3 + ens4 ë‘˜ ë‹¤ defaultë¥¼ ë„£ìœ¼ë©´ netplanì´ ì¶©ëŒë¡œ ë§‰ëŠ”ë‹¤.

---

## 1) Netplan: VLAN ì¸í„°í˜ì´ìŠ¤(ens4.810) êµ¬ì„±

### âœ… í•µì‹¬ í¬ì¸íŠ¸
- `ens4.810` ê°™ì€ ì (.) ì¸í„°í˜ì´ìŠ¤ëŠ” `ethernets:`ê°€ ì•„ë‹ˆë¼ **`vlans:` ì•„ë˜**ì— ì‘ì„±í•´ì•¼ í•œë‹¤.
- default routeëŠ” **ê´€ë¦¬ë§(ens3)** ì—ë§Œ ë‘”ë‹¤.

### `/etc/netplan/01-network-manager-all.yaml`

```yaml
network:
  version: 2
  renderer: NetworkManager

  ethernets:
    ens3:
      dhcp4: no
      addresses:
        - 10.0.10.11/28
      routes:
        - to: default
          via: 10.0.10.1
      nameservers:
        addresses: [210.220.163.82, 219.250.36.130]

    ens4:
      dhcp4: no
      addresses:
        - 192.168.0.11/24
      # âš ï¸ ens4ì— default routeë¥¼ ì¶”ê°€í•˜ë©´ ens3ì™€ ì¶©ëŒ ê°€ëŠ¥

  vlans:
    ens4.810:
      id: 810
      link: ens4
      dhcp4: no
      addresses:
        - 192.168.81.11/24 -> xxxx
        - 10.0.81.11/24
      nameservers:
        addresses: [210.220.163.82]
        search: [korea.fs.kr]
```

âš ï¸ -> ìš”ë¶€ë¶„ì—ì„œ ê·¸ëŸ°ì§€ ëª¨ë¥´ê² ìœ¼ë‚˜ í†µì‹ ì´ ì•ˆë˜ëŠ” ë¬¸ì œê°€ ìˆì–´ì„œ ìˆ˜ì •ì¤‘ì…ë‹ˆë‹¤; 
âš ï¸ -> ens í™˜ê²½ì—ì„œ 192.168.x.x ëŒ€ì—­ì´ VMWARE NAT ëŒ€ì—­ì´ë¼ ê·¸ëŸ°ê°€ í†µì‹ ì´ ì•ˆë˜ëŠ” ë¬¸ì œê°€ ìˆì–´ì„œ ëŒ€ì—­ì„ 10.0.81.x ëŒ€ì—­ìœ¼ë¡œ ë°”ê¿§ìŠµë‹ˆë‹¤. ì•„ë˜ ë‚´ìš©ì— ëŒ€í•´ì„œëŠ” ì°¸ê³ í•´ì£¼ì„¸ìš”!!!!  

---

## 2) DHCP ì„œë²„ ì„¤ì¹˜ í™•ì¸ ë° ê¸°ë³¸ íŒŒì¼ ìœ„ì¹˜

### âœ… í•µì‹¬ í¬ì¸íŠ¸
- isc-dhcp-serverëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì•„ë˜ ìœ„ì¹˜ë¥¼ ì‚¬ìš©í•œë‹¤.
- DHCP ì„¤ì • íŒŒì¼: /etc/dhcp/dhcpd.conf
- DHCP ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤ ì§€ì •: /etc/default/isc-dhcp-server

<img width="810" height="196" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-17 233025" src="https://github.com/user-attachments/assets/54ff1cdd-38b9-442f-beb7-3d19b1c408b5" />

---

## 3) DHCP ì„¤ì •(dhcpd.conf) ì‘ì„±

### âœ… í•µì‹¬ í¬ì¸íŠ¸
- /etc/dhcp/dhcpd.conf
```bash
authoritative;
ddns-update-style none;
deny bootp;
one-lease-per-client true;
ignore client-updates;

default-lease-time 86400;
max-lease-time 604800;

option domain-name "korea.fs.kr";
option domain-name-servers 210.220.163.82, 219.250.36.130;

log-facility local7;

subnet 192.168.81.0 netmask 255.255.255.0 {
  option routers 192.168.81.1;
  option subnet-mask 255.255.255.0;

  range 192.168.81.11 192.168.81.250;

  default-lease-time 1800;
  max-lease-time 3600;
}
```

<img width="827" height="601" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-17 234001" src="https://github.com/user-attachments/assets/e914316c-5526-4393-a9b6-edd9d5d688ee" />

---

## 4) DHCPê°€ â€œì–´ëŠ ì¸í„°í˜ì´ìŠ¤ì—ì„œâ€ ë°›ì„ì§€ ì§€ì •

### âœ… í•µì‹¬ í¬ì¸íŠ¸
- /etc/default/isc-dhcp-server
```bash
INTERFACESv4="ens4.810"
INTERFACESv6=""
```

<img width="823" height="595" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-17 234305" src="https://github.com/user-attachments/assets/db038d40-9147-4d70-a646-7b87b4ac752c" />

---

## 5) DHCP ì„¤ì • ê²€ì¦ & ì„œë¹„ìŠ¤ ì¬ì‹œì‘

### âœ… í•µì‹¬ í¬ì¸íŠ¸
- ì„¤ì • ë¬¸ë²• ê²€ì‚¬
```bash
sudo dhcpd -t -cf /etc/dhcp/dhcpd.conf
```

- ì¬ì‹œì‘ / ìƒíƒœ í™•ì¸
```bash
sudo systemctl restart isc-dhcp-server
sudo systemctl status isc-dhcp-server
```

<img width="958" height="505" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 003127" src="https://github.com/user-attachments/assets/31ff1c35-552c-4562-9f88-7b837b6d0630" />

---

## 6) ìŠ¤ìœ„ì¹˜ AAA + 802.1X â€œê¸€ë¡œë²Œâ€ ì„¤ì •

### âœ… Global (RADIUS-SRV / IP=10.0.10.11)
```bash
conf t
aaa new-model

radius server RADIUS-SRV
 address ipv4 10.0.10.11 auth-port 1812 acct-port 1813
 key test123

aaa authentication dot1x default group radius
aaa authorization network default group radius
aaa accounting dot1x default start-stop group radius

dot1x system-auth-control

radius-server vsa send authentication
radius-server vsa send accounting

authentication mac-move permit
end
wr
```

- aaa new-model : AAA ê¸°ëŠ¥ í™œì„±í™”(802.1X/Radius ì—°ë™ì˜ ì‹œì‘)
- radius server ... : RADIUS ì„œë²„(IP/í¬íŠ¸/í‚¤) ë“±ë¡
- aaa authentication dot1x ... : 802.1X ì¸ì¦ì„ RADIUSë¡œ í•˜ê² ë‹¤
- aaa authorization network ... : ì¸ì¦ ì„±ê³µ í›„ ë„¤íŠ¸ì›Œí¬ ê¶Œí•œ(ì˜ˆ: VLAN)ì„ RADIUS ì •ì±… ê¸°ì¤€ìœ¼ë¡œ ì ìš©
- aaa accounting dot1x ... : ì¸ì¦ ì‹œì‘/ì¢…ë£Œ ê¸°ë¡ì„ RADIUSë¡œ ì „ì†¡
- dot1x system-auth-control : ìŠ¤ìœ„ì¹˜ ì „ì²´ì—ì„œ 802.1X ë™ì‘ ON
- radius-server vsa send ... : Vendor-Specific Attribute ì „ì†¡(ì •ì±…/ì •ë³´ ì „ë‹¬)
- authentication mac-move permit : ê°™ì€ MACì´ ë‹¤ë¥¸ í¬íŠ¸ë¡œ ì´ë™ ì‹œ í—ˆìš©(ì‹¤ìŠµì—ì„œ ìì£¼ ë„ì›€ë¨)

---

## 7) ìŠ¤ìœ„ì¹˜ â€œë‹¨ë§ ì—°ê²° í¬íŠ¸â€ì— 802.1X ì ìš© (Access VLAN 810 / Guest VLAN 500)

### âœ… í•µì‹¬ í¬ì¸íŠ¸
- 802.1XëŠ” â€˜ë‹¨ë§ì´ ê½‚íŒ ì•¡ì„¸ìŠ¤ ìŠ¤ìœ„ì¹˜ í¬íŠ¸â€™ì—ì„œ ìˆ˜í–‰ëœë‹¤.
- FreeRADIUS ì„œë²„ê°€ ì—°ê²°ëœ ìŠ¤ìœ„ì¹˜ í¬íŠ¸ì— 802.1Xë¥¼ ê±¸ í•„ìš”ëŠ” ì—†ìŒ(ì„œë²„ëŠ” ê·¸ëƒ¥ ì„œë²„ íŠ¸ë˜í”½ë§Œ í†µê³¼í•˜ë©´ ë¨).

### âœ… í¬íŠ¸ ì˜ˆì‹œ (Gi0/1)
```bash
conf t
interface gi0/1
 description ## Dot1X Auth Port ##
 switchport mode access

 spanning-tree portfast
 spanning-tree bpduguard enable

 authentication port-control auto
 dot1x pae authenticator

 ! (ì„ íƒ) ì¸ì¦ ì‹¤íŒ¨/ì„œë²„ ì‘ë‹µ ì—†ìŒ ì‹œ Guest VLANìœ¼ë¡œ ë³´ë‚´ê¸°
 authentication event fail action authorize vlan 500
 authentication event no-response action authorize vlan 500
 authentication event server dead action authorize vlan 500
 authentication event server alive action reinitialize
end
wr
```

### âœ… ì°¸ê³ 
- â€œ802.1X í¬íŠ¸ ì„¤ì •ì— VLANì„ ì™œ ì•ˆ ì ëŠ” ê²½ìš°ê°€ ìˆë‚˜?â€
- 802.1X í™˜ê²½ì—ì„œëŠ” VLANì„ RADIUSê°€ ë™ì ìœ¼ë¡œ ë‚´ë ¤ì£¼ëŠ” êµ¬ì¡°ê°€ í”í•¨
- (ì˜ˆ: ì¸ì¦ ì„±ê³µ ì‹œ VLAN 810, ì‹¤íŒ¨ ì‹œ VLAN 500 ë“±)
- ê·¸ë˜ì„œ ì–´ë–¤ ë¬¸ì„œëŠ” í¬íŠ¸ì— VLANì„ ê³ ì •í•˜ì§€ ì•Šê³ , RADIUS ì •ì±…ìœ¼ë¡œ VLANì„ ê²°ì •í•˜ê¸°ë„ í•¨
- â€œê¸°ë³¸ì€ 810â€ë¡œ í•˜ê³  ì‹¶ìœ¼ë©´ switchport access vlan 810ì„ ì£¼ë©´ ë¨.
(ë™ì  VLANê¹Œì§€ ê°™ì´ í•˜ê³  ì‹¶ìœ¼ë©´ RADIUSì—ì„œ Tunnel ì†ì„±ìœ¼ë¡œ VLAN ë‚´ë ¤ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥)

---

## 8) Windows í´ë¼ì´ì–¸íŠ¸: CA ì¸ì¦ì„œ ì„¤ì¹˜ + 802.1X(PEAP) ì„¤ì •
   
### âœ… í•µì‹¬ í¬ì¸íŠ¸
- CA íŒŒì¼ì„ ë”ë¸”í´ë¦­ â†’ ì¸ì¦ì„œ ì„¤ì¹˜
- ì €ì¥ì†ŒëŠ” ë¡œì»¬ ì»´í“¨í„° â†’ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë£¨íŠ¸ ì¸ì¦ ê¸°ê´€ìœ¼ë¡œ ë„£ê¸°

ğŸ“· ì¸ì¦ì„œ ì •ë³´

<img width="488" height="592" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 032936" src="https://github.com/user-attachments/assets/6266d97d-1052-468f-adee-f4cb38be54ca" />

ğŸ“· ì €ì¥ì†Œ ì„ íƒ(ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë£¨íŠ¸ ì¸ì¦ ê¸°ê´€)

<img width="1023" height="827" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 033028" src="https://github.com/user-attachments/assets/75f7984e-7512-4a64-abc7-b922cc6086a4" />

ğŸ“· ì„¤ì¹˜ ê²½ê³ (ì§€ë¬¸ SHA1 í‘œì‹œ)

<img width="1023" height="838" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 033053" src="https://github.com/user-attachments/assets/f9920662-3ef7-465e-be03-fb745ce7741b" />


---

## 9) Windows í´ë¼ì´ì–¸íŠ¸: CA ì¸ì¦ì„œ ì„¤ì¹˜ + 802.1X(PEAP) ì„¤ì •
   
### âœ… í•µì‹¬ í¬ì¸íŠ¸
- 802.1X ìœ ì„  ì¸ì¦ì€ Windowsì—ì„œ dot3svcê°€ í•„ìš”í•¨.
- ì„œë¹„ìŠ¤: Wired AutoConfig
-  ì‹œì‘ ìœ í˜•: ìë™
- ìƒíƒœ: ì‹¤í–‰ ì¤‘

ğŸ“· dot3svc ìˆ˜ë™/ì¤‘ì§€ ìƒíƒœ

<img width="1019" height="840" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 033337" src="https://github.com/user-attachments/assets/8484877a-a5b6-4dfd-90e4-38e8ebf80fe8" />

ğŸ“· ìë™ìœ¼ë¡œ ë³€ê²½

<img width="1030" height="845" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 033353" src="https://github.com/user-attachments/assets/cfcdb1e2-7b2f-4697-b2c0-fc30a79bfe6e" />

ğŸ“· ì‹¤í–‰ ì¤‘ í™•ì¸

<img width="1018" height="848" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 033438" src="https://github.com/user-attachments/assets/15b90b6e-8640-4f9d-8f97-ca7ab7e44ded" />


---

## 10) ì´ë”ë„· ì–´ëŒ‘í„° 802.1X ì„¤ì •(PEAP)
   
### âœ… í•µì‹¬ í¬ì¸íŠ¸
- ì´ë”ë„· ì†ì„± â†’ ì¸ì¦ íƒ­
- â€œIEEE 802.1X ì¸ì¦ ì‚¬ìš©â€ ì²´í¬
- ë„¤íŠ¸ì›Œí¬ ì¸ì¦ ë°©ë²•: Microsoft: PEAP
- PEAP ì„¤ì •ì—ì„œ ì‹ ë¢°í•  ë£¨íŠ¸ ì¸ì¦ê¸°ê´€ì— ë‚´ê°€ ë§Œë“  CA ì„ íƒ
- ë‚´ë¶€ ì¸ì¦ ë°©ì‹: EAP-MSCHAP v2

- âš ï¸ "ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ"ì¸ë° ì•ˆ ë³´ì¼ ë•Œ â†’ MMCì—ì„œ ë¡œì»¬ ì»´í“¨í„° ì €ì¥ì†Œ í™•ì¸ í•„ìš”
(í˜„ì¬ ì‚¬ìš©ì ì €ì¥ì†Œì— ë“¤ì–´ê°€ë©´ 802.1Xì—ì„œ ì‹ ë¢°ê°€ ì•ˆ ì¡íˆëŠ” ê²½ìš°ê°€ ë§ë‹¤)

ğŸ“· ì¸ì¦ íƒ­ì—ì„œ 802.1X í™œì„±í™” + PEAP ì„ íƒ

<img width="1031" height="839" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 033552" src="https://github.com/user-attachments/assets/fe3464d6-5adf-42ba-bc8d-f6c6024d112b" />

ğŸ“· PEAP ì†ì„±(Trusted Root ëª©ë¡ì—ì„œ ë‚´ CA í™•ì¸)

<img width="1047" height="852" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 040504" src="https://github.com/user-attachments/assets/e327ed60-e933-4dcc-acc1-6907bfadec81" />

ğŸ“· EAP-MSCHAPv2 ì„¤ì •

<img width="442" height="225" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 040554" src="https://github.com/user-attachments/assets/33cf5cf6-a5e1-4440-a65b-ddbf17b5d94f" />

ğŸ“· 802.1X ê³ ê¸‰ ì„¤ì •

<img width="832" height="643" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 040716" src="https://github.com/user-attachments/assets/c7bdbd2d-522d-4e38-9033-db5c3d79f19d" />


---

## 10) ì´ë”ë„· ì–´ëŒ‘í„° 802.1X ì„¤ì •(PEAP)
- IPv4 â†’ ìë™ìœ¼ë¡œ IP ì£¼ì†Œ ë°›ê¸° / ìë™ìœ¼ë¡œ DNS ë°›ê¸°

ğŸ“· IPv4 DHCP ì„¤ì •

<img width="580" height="631" alt="ìŠ¤í¬ë¦°ìƒ· 2026-01-18 040812" src="https://github.com/user-attachments/assets/b84a6dfc-7917-4b71-91d4-87d537b682db" />
